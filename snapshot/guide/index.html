<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Compilation time source code generators</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/guide.js"></script>
    <script src="../js/multi-language-sample.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="../css/multi-language-sample.css"/>
    <script src="../js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>

</head>

<body class="body" id="docs" onload="addJsClass();" onhashchange="highlightMenu()">

<div id="table-of-content-nav-link" class="desktop">
    <a id="theme-switcher" title="Switch to dark theme" href="javascript:switchTheme(true)"><i class="fa fa-moon-o"></i></a>
    <a title="Collapse/Open Table of contents" title="Hide Table of Contents" href="javascript:hideTableOfContents();" class="button">[ + ]</a>
</div>

<div id="main">
    <div id="navigation" class="no-print">
        <div class="navTitle">
            <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
        </div>
        <div class="navLinks">
            <ul>
                    <li><div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)" class="desktop">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#releaseHistory"><strong>2</strong><span>Release History</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#gettingStarted"><strong>3</strong><span>Quick Start</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#generators"><strong>4</strong><span>Writing a Source Generator</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#annotations"><strong>5</strong><span>Annotations</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#repository"><strong>6</strong><span>Repository</span></a></div>
                                
                            </div>
                        </div>
                    </li>

                <li id="table-of-content-nav-link-mobile" class="mobile">
                    <a title="Scroll to Table of contents" href="javascript:scrollToTop();" class="button">Toc</a>
                </li>
                <li class="desktop">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API</a>
                </li>
                <li class="desktop">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Configuration Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Conf</a>
                </li>
            </ul>

        </div>
    </div>
    
    <div id="table-of-content">
        <div class="toc-content">

        <h2>Table of Contents</h2>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-introduction"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-releaseHistory"><a href="#releaseHistory"><strong>2</strong><span>Release History</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-gettingStarted"><a href="#gettingStarted"><strong>3</strong><span>Quick Start</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-generators"><a href="#generators"><strong>4</strong><span>Writing a Source Generator</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-annotations"><a href="#annotations"><strong>5</strong><span>Annotations</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-builder"><a href="#builder"><strong>5.1</strong><span>Builder</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-wither"><a href="#wither"><strong>5.2</strong><span>Wither</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-repository"><a href="#repository"><strong>6</strong><span>Repository</span></a></div>
        
        </div>
    </div>
    
    <div class="docs-content">
    <div class="project">
        <h1>Compilation time source code generators</h1>
        <p></p>
        <p>Micronaut SourceGen exposes a language-neutral API for source code generation.</p>
        <p><strong>Version:</strong> 1.1.1-SNAPSHOT </p>
    </div>
    
<h1 id="introduction"><a class="anchor" href="#introduction"></a>1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sourcegen/edit/1.2.x/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut SourceGen exposes a language-neutral API for performing source code generation. Since <a href="https://github.com/square/javapoet">JavaPoet</a> is no longer maintained this module includes a fork of the code with extensions to support Java Records and other modern Java constructs.</p>
</div>
<div class="paragraph">
<p>An additional API is provided in the <code>io.micronaut.sourcegen.model</code> package that abstracts both JavaPoet and KotlinPoet such that the developer can build source generators in a language neutral manner.</p>
</div>
<div class="paragraph">
<p>Any processors built with the Micronaut SourceGen API work with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java</p>
</li>
<li>
<p>Kotlin via KAPT</p>
</li>
<li>
<p>Kotlin via KSP</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that Groovy is not supported at this time of writing since it lacks APIs to add generated sources to the current compilation unit and perform multiple rounds of processing like Java and Kotlin do.</p>
</div>

<h1 id="releaseHistory"><a class="anchor" href="#releaseHistory"></a>2 Release History</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sourcegen/edit/1.2.x/src/main/docs/guide/releaseHistory.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For this project, you can find a list of releases (with release notes) here:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-sourcegen/releases">https://github.com/micronaut-projects/micronaut-sourcegen/releases</a></p>
</div>

<h1 id="gettingStarted"><a class="anchor" href="#gettingStarted"></a>3 Quick Start</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sourcegen/edit/1.2.x/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started add Micronaut SourceGen to the annotation processor scope of your build configuration:</p>
</div>
<div class="paragraph">
<p>For Java projects add:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut.sourcegen:micronaut-sourcegen-generator-java")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut.sourcegen&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-sourcegen-generator-java&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>For Kotlin projects using KSP add:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">ksp(<span class="hljs-string">"io.micronaut.sourcegen:micronaut-sourcegen-generator-kotlin")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sourcegen&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-sourcegen-generator-kotlin&lt;/artifactId&gt;
    &lt;scope&gt;ksp&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>or, for those using KAPT add:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">kapt(<span class="hljs-string">"io.micronaut.sourcegen:micronaut-sourcegen-generator-kotlin")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sourcegen&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-sourcegen-generator-kotlin&lt;/artifactId&gt;
    &lt;scope&gt;kapt&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>

<h1 id="generators"><a class="anchor" href="#generators"></a>4 Writing a Source Generator</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sourcegen/edit/1.2.x/src/main/docs/guide/generators.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To write a source generator you have a few options. If you only wish to support Java you can use the <a href="https://github.com/square/javapoet">JavaPoet API</a> that is forked into the <code>io.micronaut.sourcegen.javapoet</code> package. Since JavaPoet is no longer being developed and maintained we recommending using this fork since it is maintained as part of the project and includes support for Java 17+ constructors like Records.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can also use the language neutral code generation API defined in the <code>io.micronaut.sourcegen.model</code> package that works with both Kotlin and Java adding the ability to write code generators that work cross language.</p>
</div>
<div class="paragraph">
<p>To get started add dependency on the <code>micronaut-core-processor</code> module:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-core-processor")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-core-processor&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>And the <code>micronaut-sourcegen-model</code> module:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sourcegen:micronaut-sourcegen-model")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sourcegen&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-sourcegen-model&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The module you build will have to be placed on the annotation processor classpath of the target project. You CANNOT mix source generation code and application code is the same source tree. Typically you will have a separate project for your source generator a separate project for your application that uses the source generator. In addition the <code>micronaut-core-processor</code> module should NEVER be in the application classpath.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is an example of using the API:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Internal;
import io.micronaut.core.annotation.NonNull;
import io.micronaut.inject.ast.ClassElement;
import io.micronaut.inject.visitor.TypeElementVisitor;
import io.micronaut.inject.visitor.VisitorContext;
import io.micronaut.sourcegen.custom.example.GenerateInterface;
import io.micronaut.sourcegen.generator.SourceGenerator;
import io.micronaut.sourcegen.generator.SourceGenerators;
import io.micronaut.sourcegen.model.InterfaceDef;
import io.micronaut.sourcegen.model.MethodDef;
import io.micronaut.sourcegen.model.TypeDef;

import javax.lang.model.element.Modifier;
import java.io.IOException;

@Internal
public final class GenerateInterfaceBuilder implements TypeElementVisitor&lt;GenerateInterface, Object&gt; { // <b class="conum">(1)</b>

    @Override
    public @NonNull VisitorKind getVisitorKind() {
        return VisitorKind.ISOLATING;
    } // <b class="conum">(2)</b>

    @Override
    public void visitClass(ClassElement element, VisitorContext context) {
        SourceGenerator sourceGenerator = SourceGenerators.findByLanguage(context.getLanguage()).orElse(null); // <b class="conum">(3)</b>
        if (sourceGenerator == null) {
            return;
        }

        String builderClassName = element.getPackageName() + ".MyInterface1";

        InterfaceDef interfaceDef = InterfaceDef.builder(builderClassName) // <b class="conum">(4)</b>
            .addModifiers(Modifier.PUBLIC)

            .addMethod(MethodDef.builder("findLong")
                .addModifiers(Modifier.ABSTRACT, Modifier.PUBLIC)
                .returns(Long.class)
                .build())

            .addMethod(MethodDef.builder("saveString")
                .addModifiers(Modifier.ABSTRACT, Modifier.PUBLIC)
                .addParameter("myString", String.class)
                .returns(TypeDef.VOID)
                .build())

            .build();

        context.visitGeneratedSourceFile(interfaceDef.getPackageName(), interfaceDef.getSimpleName(), element) // <b class="conum">(5)</b>
            .ifPresent(generatedFile -&gt; {
                try {
                    generatedFile.write(writer -&gt; sourceGenerator.write(interfaceDef, writer));
                } catch (IOException e) {
                    throw new RuntimeException(e);
                }
            });
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A source generator should implement <code>TypeElementVisitor</code>. The first type argument is the type-level annotation you want to visit in source code the second argument is the member level (field, method, constructor) level annotation. You can specify <code>Object</code> to visit all.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>VisitorKind</code> should typically be <code>ISOLATING</code> if you generate a single source file corresponding to a single originating source file (1-to-1 mapping). If you generate a source file that takes into account multiple other source files then change this to <code>AGGREGATING</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You should obtain an instance of <a href="../api/io/micronaut/sourcegen/generator/SourceGenerator.html">SourceGenerator</a> from the context, in general this should never be <code>null</code> but you never know if a new language is added in the the future.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can use one of the <code>*Def</code> classes as a builder to build the source file. In this case we use <a href="../api/io/micronaut/sourcegen/model/InterfaceDef.html">InterfaceDef</a> but there are others like <a href="../api/io/micronaut/sourcegen/model/RecordDef.html">RecordDef</a>, <a href="../api/io/micronaut/sourcegen/model/ClassDef.html">ClassDef</a> etc.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Once you have built the model write it to a source file!</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To see more examples take a look at some of the existing implementations like <a href="https://github.com/micronaut-projects/micronaut-sourcegen/blob/master/sourcegen-generator/src/main/java/io/micronaut/sourcegen/generator/visitors/BuilderAnnotationVisitor.java">BuilderAnnotationVisitor</a> that powers the <a href="../api/io/micronaut/sourcegen/annotations/Builder.html">@Builder</a> annotation.
</td>
</tr>
</table>
</div>

<h1 id="annotations"><a class="anchor" href="#annotations"></a>5 Annotations</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sourcegen/edit/1.2.x/src/main/docs/guide/annotations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The module Micronaut SourceGen annotations ships with annotations which you can use in your projects:</p>
</div>
<div class="paragraph">
<p>To use them, you need the following dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sourcegen:micronaut-sourcegen-annotations")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sourcegen&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-sourcegen-annotations&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/sourcegen/annotations/Builder.html">Builder</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a builder of the annotated type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/sourcegen/annotations/Wither.html">Wither</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create an interface with copy style method and possible builder style methods for a record</p></td>
</tr>
</tbody>
</table>

<h2 id="builder"><a class="anchor" href="#builder"></a>5.1 Builder</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sourcegen/edit/1.2.x/src/main/docs/guide/annotations/builder.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you annotate a Java Record with <code>@Builder</code>, a <code>PersonBuilder</code> class is generated at compilation-time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.sourcegen.annotations.Builder;

@Builder
public record Person(Long id, String name, byte[] bytes) {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use a <a href="https://blogs.oracle.com/javamagazine/post/exploring-joshua-blochs-builder-design-pattern-in-java">builder pattern</a> to create a <code>Person</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void buildsPerson() {
    var person = PersonBuilder.builder()
        .id(123L)
        .name("Cédric")
        .bytes(new byte[]{1,2,3})
        .build();
    assertEquals("Cédric", person.name());
    assertArrayEquals(new byte[]{1, 2, 3}, person.bytes());
    assertEquals(123L, person.id());
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="https://github.com/micronaut-projects/micronaut-sourcegen/blob/master/sourcegen-generator/src/main/java/io/micronaut/sourcegen/generator/visitors/BuilderAnnotationVisitor.java">BuilderAnnotationVisitor</a> is an example of how to use the Micronaut SourceGen API.
</td>
</tr>
</table>
</div>

<h2 id="wither"><a class="anchor" href="#wither"></a>5.2 Wither</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sourcegen/edit/1.2.x/src/main/docs/guide/annotations/wither.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you annotate a Java Record with <code>@Wither</code>, a <code>YourRecordWither</code> interface is generated at compilation-time with all the methods having a default implementation (nothing needs to be implemented). The record class can add that interface using <code>implements YourRecordWither</code> which will expand it with the default <code>withProperty</code> copy style methods like <code>YourRecord withPropertyName(PropertyValue)</code>, calling those methods will create a copy of the record with a modified property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Wither
public record Walrus (
    @NonNull
    String name,
    int age,
    byte[] chipInfo
) implements WalrusWither  {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example of different ways to use the copy methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void test() throws Exception {
    Walrus walrus = new Walrus("Abc", 123, new byte[]{56});

    assertEquals(walrus.name(), "Abc");
    assertEquals(walrus.age(), 123);
    assertArrayEquals(walrus.chipInfo(), new byte[]{56});

    Walrus finalWalrus = walrus;
    // The name property is annotated with @NonNull the `withName(null)` method should fail
    assertThrowsExactly(NullPointerException.class, () -&gt; finalWalrus.withName(null));

    walrus = walrus.withName("Xyz");

    assertEquals(walrus.name(), "Xyz");
    assertEquals(walrus.age(), 123);
    assertArrayEquals(walrus.chipInfo(), new byte[]{56});

    walrus = walrus.withAge(99);

    assertEquals(walrus.name(), "Xyz");
    assertEquals(walrus.age(), 99);
    assertArrayEquals(walrus.chipInfo(), new byte[]{56});

    walrus = walrus.withChipInfo(new byte[]{1, 2, 3});

    assertEquals(walrus.name(), "Xyz");
    assertEquals(walrus.age(), 99);
    assertArrayEquals(walrus.chipInfo(), new byte[]{1, 2, 3});
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your record is annotated with <a href="../api/io/micronaut/sourcegen/annotations/Builder.html">Builder</a> the wither interface will also include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>default YourRecordBuilder with() {&#8230;&#8203;}</code> method that will return the record builder populated with the current values of the record</p>
</li>
<li>
<p><code>default YourRecord with(Consumer&lt;YourRecordBuilder&gt; consumer) {&#8230;&#8203;}</code> a method receiving a lambda that can modify the populated record builder with the current values of the record and producing a new instance of a record as a result</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Wither
@Builder
public record Walrus2(
    String name,
    int age,
    byte[] chipInfo
) implements Walrus2Wither  {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example of different ways to use the copy and builder methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void testWitherAndBuilder() throws Exception {
    Walrus2 walrus = new Walrus2("Abc", 123, new byte[]{56});

    assertEquals(walrus.name(), "Abc");
    assertEquals(walrus.age(), 123);
    assertArrayEquals(walrus.chipInfo(), new byte[]{56});

    // The name property is NOT annotated with @NotNull so `withName(null)` method should NOT fail
    walrus = walrus.withName(null);

    assertNull(walrus.name());
    assertEquals(walrus.age(), 123);
    assertArrayEquals(walrus.chipInfo(), new byte[]{56});

    walrus = walrus.withName("Xyz");

    assertEquals(walrus.name(), "Xyz");
    assertEquals(walrus.age(), 123);
    assertArrayEquals(walrus.chipInfo(), new byte[]{56});

    walrus = walrus.withAge(99);

    assertEquals(walrus.name(), "Xyz");
    assertEquals(walrus.age(), 99);
    assertArrayEquals(walrus.chipInfo(), new byte[]{56});

    walrus = walrus.withChipInfo(new byte[]{1, 2, 3});

    assertEquals(walrus.name(), "Xyz");
    assertEquals(walrus.age(), 99);
    assertArrayEquals(walrus.chipInfo(), new byte[]{1, 2, 3});

    walrus = walrus.with().build();

    assertEquals(walrus.name(), "Xyz");
    assertEquals(walrus.age(), 99);
    assertArrayEquals(walrus.chipInfo(), new byte[]{1, 2, 3});

    walrus = walrus.with().name("Foobar").build();

    assertEquals(walrus.name(), "Foobar");
    assertEquals(walrus.age(), 99);
    assertArrayEquals(walrus.chipInfo(), new byte[]{1, 2, 3});

    walrus = walrus.with().name("Abc").age(123).chipInfo(new byte[]{9, 8, 7}).build();

    assertEquals(walrus.name(), "Abc");
    assertEquals(walrus.age(), 123);
    assertArrayEquals(walrus.chipInfo(), new byte[]{9, 8, 7});

    walrus = walrus.with(builder -&gt; builder.name("Denis"));

    assertEquals(walrus.name(), "Denis");
    assertEquals(walrus.age(), 123);
    assertArrayEquals(walrus.chipInfo(), new byte[]{9, 8, 7});

    walrus = walrus.with(builder -&gt; builder.name("Kevin").age(1).chipInfo(new byte[]{123}));

    assertEquals(walrus.name(), "Kevin");
    assertEquals(walrus.age(), 1);
    assertArrayEquals(walrus.chipInfo(), new byte[]{123});
}</code></pre>
</div>
</div>

<h1 id="repository"><a class="anchor" href="#repository"></a>6 Repository</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sourcegen/edit/1.2.x/src/main/docs/guide/repository.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can find the source code of this project in this repository:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-sourcegen">https://github.com/micronaut-projects/micronaut-sourcegen</a></p>
</div>

    </div>
</div>

<script type="text/javascript">

</script>
</body>
</html>
